---
import Layout from "../../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { resolvePath, detectLocale, buildLocalizedPath } from "../../../utils/paths";

export async function getStaticPaths() {
    const activities = await getCollection("activity");
    const locales = ['ja', 'en'] as const;
    return locales.flatMap((locale) =>
        activities.map((activity) => ({
            params: { locale, id: activity.id },
            props: { activity },
        }))
    );
}

const { activity } = Astro.props;
const locale = detectLocale(Astro.url.pathname);
const copy = {
    ja: {
        back: "← 戻る",
        metaTitle: `${activity.data.title} | 坂田・森・浅谷・西本研究室`,
        external: "関連リンクを開く →",
    },
    en: {
        back: "← Back",
        metaTitle: `${activity.data.title} | Sakata / Mori / Asatani / Nishimoto Lab`,
        external: "Open related link →",
    },
} as const;

const t = copy[locale];
const listPath = buildLocalizedPath(locale, "activity");
---

<Layout title={t.metaTitle}>
    <main class="main-content">
        <section class="page-header">
            <button type="button" class="back-link" onclick="history.back()">{t.back}</button>
            <h1>{activity.data.title}</h1>
            <div class="activity-date">
                {activity.data.date.replace(/-/g, ".")}
            </div>
        </section>

        <section class="content-section">
            <div class="activity-detail">
                {
                    activity.data.image && (
                        <img
                            src={resolvePath(activity.data.image)}
                            alt={activity.data.title}
                            class="detail-image"
                            loading="lazy"
                            decoding="async"
                        />
                    )
                }
                <p class="description">{activity.data.description}</p>
                {
                    activity.data.link && (
                        <div class="external-link-container">
                            <a
                                href={activity.data.link}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="external-link"
                            >
                                {t.external}
                            </a>
                        </div>
                    )
                }
            </div>
        </section>
    </main>
</Layout>

<style>
    .page-header {
        margin-bottom: 3rem;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--accent);
        background: none;
        border: none;
        padding: 0;
        font: inherit;
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

    .back-link:hover {
        transform: translateX(-4px);
    }

    .page-header h1 {
        font-size: 1.75rem;
        font-weight: 500;
        margin-bottom: 0.5rem;
        line-height: 1.4;
    }

    .activity-date {
        font-family: var(--font-mono);
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    .content-section {
        margin-bottom: 3rem;
    }

    .activity-detail {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .description {
        font-size: 1.05rem;
        color: var(--text-secondary);
        line-height: 1.8;
        padding: 1.5rem;
        background: var(--bg-card);
        border-left: 3px solid var(--accent);
        border-radius: 4px;
    }

    .detail-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid var(--border);
    }

    .external-link-container {
        margin-top: 1rem;
    }

    .external-link {
        display: inline-block;
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
        transition: transform 0.2s ease;
    }

    .external-link:hover {
        transform: translateX(4px);
    }
</style>
