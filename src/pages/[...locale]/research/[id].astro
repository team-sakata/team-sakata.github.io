---
import Layout from "../../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { resolvePath, detectLocale, buildLocalizedPath } from "../../../utils/paths";

export async function getStaticPaths() {
    const researchFocus = await getCollection("research-focus");
    const locales = ['ja', 'en'] as const;
    return locales.flatMap((locale) =>
        researchFocus.map((focus) => ({
            params: { locale, id: focus.id },
            props: { focus },
        }))
    );
}

const { focus } = Astro.props;
const locale = detectLocale(Astro.url.pathname);
const isJa = locale === "ja";

const copy = {
    ja: {
        back: "← 戻る",
        metaTitle: `${focus.data.title_ja || focus.data.title} | 坂田・森・浅谷・西本研究室`,
        relatedLink: "関連リンクを開く →",
    },
    en: {
        back: "← Back",
        metaTitle: `${focus.data.title_en || focus.data.title} | Sakata / Mori / Asatani / Nishimoto Lab`,
        relatedLink: "Open related link →",
    },
} as const;

const t = copy[locale];
const listPath = buildLocalizedPath(locale, "research");

const title = isJa
    ? (focus.data.title_ja || focus.data.title)
    : (focus.data.title_en || focus.data.title);

const description = isJa
    ? (focus.data.description_ja || focus.data.description)
    : (focus.data.description_en || focus.data.description);
---

<Layout title={t.metaTitle} isSubpage>
    <main class="main-content">
        <section class="page-header">
            <button type="button" class="back-link" onclick="history.back()">{t.back}</button>
            <h1>{title}</h1>
            {focus.data.label && (
                <span class="label-tag">{focus.data.label}</span>
            )}
        </section>

        <section class="content-section">
            <div class="focus-detail">
                {focus.data.image && (
                    <img
                        src={resolvePath(focus.data.image)}
                        alt={title}
                        class="detail-image"
                        loading="lazy"
                        decoding="async"
                    />
                )}
                <p class="description">{description}</p>
                {focus.data.link && (
                    <div class="external-link-container">
                        <a
                            href={focus.data.link}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="external-link"
                        >
                            {t.relatedLink}
                        </a>
                    </div>
                )}
            </div>
        </section>
    </main>
</Layout>

<style>
    .page-header {
        margin-bottom: 3rem;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--accent);
        background: none;
        border: none;
        padding: 0;
        font: inherit;
        font-size: 0.9rem;
        margin-bottom: 1.5rem;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

    .back-link:hover {
        transform: translateX(-4px);
    }

    .page-header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        line-height: 1.4;
    }

    .label-tag {
        display: inline-block;
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 4px;
        color: var(--text-secondary);
        margin-top: 0.5rem;
    }

    .content-section {
        margin-bottom: 3rem;
    }

    .focus-detail {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .description {
        font-size: 1.05rem;
        color: var(--text-secondary);
        line-height: 1.8;
        padding: 1.5rem;
        background: var(--bg-card);
        border-left: 3px solid var(--accent);
        border-radius: 4px;
    }

    .detail-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid var(--border);
    }

    .external-link-container {
        margin-top: 1rem;
    }

    .external-link {
        display: inline-block;
        color: var(--accent);
        text-decoration: none;
        font-weight: 500;
        transition: transform 0.2s ease;
    }

    .external-link:hover {
        transform: translateX(4px);
    }
</style>
