---
import Layout from "../../layouts/Layout.astro";
import NewsItem from "../../components/NewsItem.astro";
import PageHeader from "../../components/PageHeader.astro";
import Section from "../../components/Section.astro";
import news from "../../data/news.yaml";
import { detectLocale } from "../../utils/paths";

export function getStaticPaths() {
    return [
        { params: { locale: 'ja' } },
        { params: { locale: 'en' } },
    ];
}

// Group news by year
const newsByYear = news.reduce(
  (
    acc: Record<string, typeof news>,
    item: { date: string; text: string; link?: string },
  ) => {
    const year = item.date.split(".")[0];
    if (!acc[year]) {
      acc[year] = [];
    }
    acc[year].push(item);
    return acc;
  },
  {},
);

const years = Object.keys(newsByYear).sort((a, b) => Number(b) - Number(a));

const locale = detectLocale(Astro.url.pathname);
const copy = {
  ja: {
    metaTitle: "お知らせ | 坂田・森・浅谷・西本研究室",
    pageTitle: "お知らせ",
  },
  en: {
    metaTitle: "News | Sakata / Mori / Asatani / Nishimoto Lab",
    pageTitle: "News",
  },
} as const;

const t = copy[locale];
---

<Layout title={t.metaTitle} isSubpage>
  <PageHeader title={t.pageTitle} />

  {
    years.map((year) => (
      <Section title={year}>
        <div class="news-list">
          {newsByYear[year].map(
            (item: { date: string; text: string; link?: string }) => (
              <NewsItem news={item} />
            ),
          )}
        </div>
      </Section>
    ))
  }
</Layout>

<style>
  .news-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
</style>
